-- üß© Complete Pet Hatch Simulator + Mutation Finder with ESP

local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local mouse = player:GetMouse()

-- ü•ö Pet Definitions
local petTable = {
    ["Common Egg"] = {"Dog","Bunny","Golden Lab"},
    ["Uncommon Egg"] = {"Chicken","Black Bunny","Cat","Deer"},
    ["Rare Egg"] = {"Pig","Monkey","Rooster","Orange Tabby","Spotted Deer"},
    ["Legendary Egg"] = {"Cow","Polar Bear","Sea Otter","Turtle","Silver Monkey"},
    ["Mythical Egg"] = {"Grey Mouse","Brown Mouse","Squirrel","Red Giant Ant"},
    ["Bug Egg"] = {"Snail","Caterpillar","Giant Ant","Praying Mantis"},
    ["Night Egg"] = {"Frog","Hedgehog","Mole","Echo Frog","Night Owl"},
    ["Bee Egg"] = {"Bee","Honey Bee","Bear Bee","Petal Bee"},
    ["Anti Bee Egg"] = {"Wasp","Moth","Tarantula Hawk"},
    ["Oasis Egg"] = {"Meerkat","Sand Snake","Axolotl"},
    ["Paradise Egg"] = {"Ostrich","Peacock","Capybara"},
    ["Dinosaur Egg"] = {"Raptor","Triceratops","Stegosaurus","T-Rex"},
    ["Primal Egg"] = {"Parasaurolophus","Iguanodon","Pachycephalosaurus"},
    ["Zen Egg"] = {"Shiba Inu","Nihonzaru","Tanuki"},
}

-- üß† State Variables
local espEnabled = true
local truePetMap = {}

-- üß© Helpers
local function glitchLabelEffect(label)
    coroutine.wrap(function()
        local orig = label.TextColor3
        for _ = 1,2 do
            label.TextColor3 = Color3.new(1,0,0); wait(0.07)
            label.TextColor3 = orig; wait(0.07)
        end
    end)()
end

-- üìç Pet ESP (single egg only)
local currentEggESP = { gui = nil, conn = nil }

local function clearPetESP()
    if currentEggESP.gui then currentEggESP.gui:Destroy(); currentEggESP.gui = nil end
    if currentEggESP.conn then currentEggESP.conn:Disconnect(); currentEggESP.conn = nil end
end

local function applyPetESP(eggModel, petName)
    clearPetESP()
    local base = eggModel:FindFirstChildWhichIsA("BasePart")
    if not base or not espEnabled then return end

    local gui = Instance.new("BillboardGui", base)
    gui.Name = "PetBillboard"; gui.Size = UDim2.new(0,270,0,50)
    gui.StudsOffset = Vector3.new(0,4.5,0); gui.AlwaysOnTop = true; gui.MaxDistance = 500

    local label = Instance.new("TextLabel", gui)
    label.Size = UDim2.new(1,0,1,0); label.BackgroundTransparency = 1
    label.Font = Enum.Font.FredokaOne; label.TextScaled = true
    label.Text = eggModel.Name.." | "..petName; label.TextColor3 = Color3.new(1,1,1)
    glitchLabelEffect(label)

    local highlight = Instance.new("Highlight", eggModel)
    highlight.Name = "PetHighlight"; highlight.FillColor = Color3.fromRGB(255,200,0)
    highlight.OutlineColor = Color3.new(1,1,1); highlight.FillTransparency = 0.7
    highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop

    -- Keep rainbow pulse
    currentEggESP.gui = gui
    currentEggESP.conn = RunService.RenderStepped:Connect(function()
        if gui and label then
            label.TextColor3 = espEnabled and Color3.fromHSV(math.abs(math.sin(tick())),1,1) or Color3.new(1,1,1)
        end
    end)
end

-- Egg finder
local function getPlayerGardenEggs(radius)
    local eggs = {}
    local root = (player.Character or player.CharacterAdded:Wait()):FindFirstChild("HumanoidRootPart")
    if not root then return eggs end
    for _, obj in ipairs(Workspace:GetDescendants()) do
        if obj:IsA("Model") and petTable[obj.Name] then
            local mag = (obj:GetModelCFrame().Position - root.Position).Magnitude
            if mag <= (radius or 60) then
                table.insert(eggs, obj)
                if not truePetMap[obj] then
                    truePetMap[obj] = petTable[obj.Name][math.random(#petTable[obj.Name])]
                end
            end
        end
    end
    return eggs
end

-- Pet randomizer
local function randomizeNearbyEggs()
    local eggs = getPlayerGardenEggs(60)
    for _, egg in ipairs(eggs) do
        truePetMap[egg] = petTable[egg.Name][math.random(#petTable[egg.Name])]
    end
    if espEnabled and eggs[1] then
        applyPetESP(eggs[1], truePetMap[eggs[1]])
    end
end

-- Countdown flash
local function flashEffect(btn)
    local orig = btn.BackgroundColor3
    for _ =1,3 do
        btn.BackgroundColor3 = Color3.new(1,1,1); wait(0.05)
        btn.BackgroundColor3 = orig; wait(0.05)
    end
end

local function countdownAndRandomize(btn)
    for i =5,1,-1 do
        btn.Text = "üé≤ Randomize in: "..i
        wait(1)
    end
    flashEffect(btn)
    randomizeNearbyEggs()
    btn.Text = "üé≤ Randomize Pets"
end

-- üõ†Ô∏è GUI Construction
local screenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
screenGui.Name = "PetHatchGui"

local frame = Instance.new("Frame", screenGui)
frame.Size = UDim2.new(0,260,0,300); frame.Position = UDim2.new(0,20,0,100)
frame.BackgroundColor3 = Color3.fromRGB(0,128,128); frame.BorderSizePixel = 0
Instance.new("UICorner", frame).CornerRadius = UDim.new(0,10)

-- Close (hide only!)
local closeBtn = Instance.new("TextButton", frame)
closeBtn.Size = UDim2.new(0,24,0,24); closeBtn.Position = UDim2.new(1,-28,0,4)
closeBtn.BackgroundColor3 = Color3.fromRGB(255,0,0); closeBtn.Text = "‚ùå"
Instance.new("UICorner", closeBtn).CornerRadius = UDim.new(0,6)
closeBtn.MouseButton1Click:Connect(function()
    screenGui.Enabled = false
end)

-- Dragging
local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1,0,0,30); title.Position = UDim2.new(0,0,0,0)
title.Text = "üêæ Pet Randomizer ‚ú®"; title.Font = Enum.Font.FredokaOne
title.TextColor3 = Color3.new(1,1,1); title.BackgroundTransparency = 1

local drag = Instance.new("TextButton", title)
drag.Size = UDim2.new(1,0,1,0); drag.BackgroundTransparency = 1
local dragging, offset
drag.MouseButton1Down:Connect(function()
    dragging = true
    offset = Vector2.new(mouse.X - frame.Position.X.Offset, mouse.Y - frame.Position.Y.Offset)
end)
UserInputService.InputEnded:Connect(function() dragging = false end)
RunService.RenderStepped:Connect(function()
    if dragging then
        frame.Position = UDim2.new(0, mouse.X - offset.X, 0, mouse.Y - offset.Y)
    end
end)

-- Buttons: Randomize, ESP Toggle, Auto-Rand, Mutation Finder
local function createBtn(name, top)
    local b = Instance.new("TextButton", frame)
    b.Size = UDim2.new(1,-20,0,40)
    b.Position = UDim2.new(0,10,0,top)
    b.Font = Enum.Font.FredokaOne; b.TextColor3 = Color3.new(1,1,1); b.TextSize = 18
    Instance.new("UICorner", b).CornerRadius = UDim.new(0,6)
    return b
end

local randBtn = createBtn("üé≤ Randomize Pets", 40)
randBtn.BackgroundColor3 = Color3.fromRGB(128,0,128)
randBtn.MouseButton1Click:Connect(function() countdownAndRandomize(randBtn) end)

local espBtn = createBtn("üëÅÔ∏è ESP: ON", 90)
espBtn.BackgroundColor3 = Color3.fromRGB(205,92,122)
espBtn.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    espBtn.Text = espEnabled and "üëÅÔ∏è ESP: ON" or "üëÅÔ∏è ESP: OFF"
    if not espEnabled then clearPetESP() end
end)

local autoBtn = createBtn("üîÅ Auto Randomize: OFF", 140)
autoBtn.BackgroundColor3 = Color3.fromRGB(134,87,133)
local autoOn, bestPets = false, {["T-Rex"]=true,["Spinosaurus"]=true,["Kitsune"]=true}
autoBtn.MouseButton1Click:Connect(function()
    autoOn = not autoOn
    autoBtn.Text = autoOn and "üîÅ Auto Randomize: ON" or "üîÅ Auto Randomize: OFF"
    if autoOn then
        coroutine.wrap(function()
            while autoOn do
                countdownAndRandomize(randBtn)
                for _,p in pairs(truePetMap) do
                    if bestPets[p] then autoOn=false; autoBtn.Text="üîÅ Auto Randomize: OFF" break end
                end; wait(1)
            end
        end)()
    end
end)

-- üß¨ Pet Mutation Finder button
local mutBtn = createBtn("üî¨ Pet Mutation Finder", 190)
mutBtn.BackgroundColor3 = Color3.fromRGB(216,148,169)
local mutationActive = false
mutBtn.MouseButton1Click:Connect(function()
    if not mutationActive then
        mutationActive = true
        loadstring(game:HttpGet("https://raw.githubusercontent.com/Crimson-Lag/x/refs/heads/main/PetMutationV2"))()
    else
        warn("Mutation Finder already active.")
    end
end)

-- Credit text
local credit = Instance.new("TextLabel", frame)
credit.Size, credit.Position = UDim2.new(1,0,0,20), UDim2.new(0,0,1,-25)
credit.BackgroundTransparency, credit.Font = 1, Enum.Font.FredokaOne
credit.TextColor3, credit.TextSize = Color3.fromRGB(200,200,200), 14
credit.Text = "Made by ‚Äì Kitsu"
